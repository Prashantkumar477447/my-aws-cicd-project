name: CI/CD Dev Branch Deployment

on:
  workflow_dispatch:
    inputs:
      confirm_deployment:
        description: "Type YES to confirm deployment to the dev environment"
        required: true
        default: "NO"

jobs:
  deploy-dev:
    # Only proceed if the input is 'YES'
    if: github.event.inputs.confirm_deployment == 'YES'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout dev branch
        uses: actions/checkout@v4
        with:
          ref: dev

      - name: Deploy dev branch to EC2
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.AWS_HOST }}
          username: ${{ secrets.AWS_USER }}
          key: ${{ secrets.AWS_KEY }}
          script: |
            # Ensure the directory exists
            mkdir -p /home/ubuntu/dev_app
            cd /home/ubuntu/dev_app

            # Pull latest changes from the dev branch
            git init
            git remote add origin https://github.com/${{ github.repository }}.git || true
            git fetch origin dev
            git checkout dev || git checkout -b dev
            git pull origin dev

            # Optional: Copy files if it's a static site
            cp -r * /home/ubuntu/dev_app/
